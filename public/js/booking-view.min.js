jQuery(function(g){var h=new Date();var f=new Date(booking_view_params.server_unix_time*1000);var b=f-h;var i=[];var e=function(){location.reload()};var d=function(j){var k=new Date();k.setTime(k.getTime()+b);g("#current-time").text(moment(k.getTime()).format(booking_view_params.time_format));g("#current-date").text(moment(k.getTime()).format(booking_view_params.date_format));if(k.getHours()===0&&k.getMinutes()===0){setTimeout(e,1000)}if(j){setInterval(d,60000)}};var c=function(m){if(false===m.next_booking_container){g("#next-booking-container").hide()}else{g("#next-booking-container").show()}delete m.next_booking_container;for(var k in m){var l="#"+k.replace(/_/g,"-");var j=g(l).text();if(j!==m[k]){g(l).text(m[k].toString())}}};var a=function(){var j=new Date();if(typeof i.booking!=="undefined"&&i.booking.hasOwnProperty("abort")){i.booking.abort()}i.booking=g.ajax({type:"GET",url:booking_view_params.ajax_url,data:{product_id:booking_view_params.product_id,username:booking_view_params.username,password:booking_view_params.password,version:2,from:f/1000|0,to:f/1000|0+86400},success:function(n){g("#error").hide();var p={product_title:"",current_booking_title:"",current_booking_end:"",current_status:booking_view_params.text.available,next_booking_container:false,next_booking_title:"",next_booking_time:"",next_booking_date:""};if(n.hasOwnProperty("options")){h=new Date();f=new Date(n.options.server_unix_time*1000);b=f-h;console.log("Query time is: "+(Date.now()-j)/1000+" seconds");p.product_title=n.options.default_product_name;booking_view_params.date_format=n.options.date_format;booking_view_params.time_format=n.options.time_format}setTimeout(d,(60-f.getSeconds())*1000,true);if(n.hasOwnProperty("bookings")){var l=f/1000|0;for(var m=0;m<n.bookings.length;m++){var k=n.bookings[m].order;var o=n.bookings[m].customer;if(n.bookings[m].unix_start_time<l&&n.bookings[m].unix_end_time>l){if(k!==null&&k.hasOwnProperty("billing_company")&&k.billing_company.length>0){p.current_booking_title=k.billing_company}else{p.current_booking_title=o.display_name}p.current_status=booking_view_params.text.in_use;p.product_title=n.bookings[m].product_name;p.current_booking_end=moment.utc(n.bookings[m].unix_end_time*1000).format(booking_view_params.time_format)}else{if(n.bookings[m].unix_start_time>l){p.next_booking_container=true;if(k!==null&&k.hasOwnProperty("billing_company")&&k.billing_company.length>0){p.next_booking_title=k.billing_company}else{p.next_booking_title=o.display_name}var q=moment.utc(n.bookings[m].unix_start_time*1000);p.next_booking_date=q.format(booking_view_params.date_format);p.next_booking_time=q.format(booking_view_params.time_format);break}}}c(p)}},error:function(){g("#error").show()},dataType:"json"})};g.fn.disableSelection=function(){return this.attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).on("selectstart",false)};g(".unselectable").disableSelection();d(false);a();setInterval(a,60000)});