var calendar;function isProductCategoryShown(a){var c=$(".manage-column[id]:not(.hidden)").map(function(){if(this.id==="wbe-uncategorized"){return this.id}return Number(this.id.substring(13))}).get();if(0===a.length&&-1<c.indexOf("wbe-uncategorized")){return true}for(var b=0;b<a.length;b++){if(-1!==c.indexOf(a[b])){return true}}return false}function calendarRemoveHiddenResources(){calendar.refetchResources();var c=calendar.getResources();for(var b=0;b<c.length;b++){var a=[];if(c[b].extendedProps.hasOwnProperty("categories")){a=c[b].extendedProps.categories}if(!isProductCategoryShown(a)){c[b].remove()}}}var oldSaveManageColumnsState=window.columns.saveManageColumnsState;window.columns.saveManageColumnsState=function(){calendarRemoveHiddenResources();oldSaveManageColumnsState.call(window.columns)};document.addEventListener("DOMContentLoaded",function(){var b=document.getElementById("calendar");var c=[];function a(e){if(!confirm(fullcalendarOptions.confirmMoveMessage)){e.revert()}else{var d=e.event.end;if(null===d&&false===e.event.allDay){d=new Date(e.event.start.getTime()+3600000)}var f={_ajax_nonce:fullcalendarOptions.events.nonce,id:e.event.id,start:e.event.start!==null?e.event.start.toISOString():null,end:d!==null?d.toISOString():null,allDay:e.event.allDay};if(e.hasOwnProperty("newResource")&&e.newResource!==null){f.resource=e.newResource.id}c.booking=$.ajax({type:"POST",url:fullcalendarOptions.events.wctargetUrl,data:f,success:function(g){calendar.refetchEvents()},error:function(g,i,h){e.revert()},complete:function(){},dataType:"json"})}}calendar=new FullCalendar.Calendar(b,{plugins:["interaction","resourceDayGrid","resourceTimeGrid","list"],defaultView:fullcalendarOptions.defaultView,defaultDate:fullcalendarOptions.defaultDate,schedulerLicenseKey:fullcalendarOptions.schedulerLicenseKey,allDaySlot:true,editable:true,selectable:true,eventLimit:true,nowIndicator:true,navLinks:true,contentHeight:"auto",businessHours:[{daysOfWeek:[1,2,3,4,5],startTime:"08:00",endTime:"18:00"},{daysOfWeek:[6],startTime:"10:00",endTime:"16:00"},{daysOfWeek:[0],startTime:"13:00",endTime:"20:00"}],customButtons:{addButton:{icon:"fc-icon-plus-square",click:function(){tb_show(fullcalendarOptions.createEventTitle,fullcalendarOptions.events.eventPageUrl+"&"+$.param({_wpnonce:fullcalendarOptions.events.nonce}))}}},header:{left:"addButton, prev,next today",center:"title",right:"resourceTimeGridDay,resourceTimeGridTwoDay,timeGridWeek,dayGridMonth,listWeek"},views:{resourceTimeGridTwoDay:{type:"resourceTimeGrid",duration:{days:2},buttonText:"2 days"},listWeek:{buttonText:"list"}},resources:fullcalendarOptions.resources,eventSources:[{url:fullcalendarOptions.events.sourceUrl,method:"POST",extraParams:{_ajax_nonce:fullcalendarOptions.events.nonce}}],eventRender:function(d){$(d.el).on("click",function(f){if($(this).attr("id").length&&$(this).attr("id").substring(0,10)==="wbe-event-"){var g={_wpnonce:fullcalendarOptions.events.nonce,id:$(this).attr("id").substring(10)};tb_show(fullcalendarOptions.updateEventTitle,fullcalendarOptions.events.eventPageUrl+"&"+$.param(g))}f.preventDefault()});if(d.event.id.length){if(d.event.extendedProps.hasOwnProperty("isExternal")&&d.event.extendedProps.isExternal){$(d.el).attr("id","ext-event-"+d.event.id)}else{$(d.el).attr("id","wbe-event-"+d.event.id)}}if(d.event.extendedProps.hasOwnProperty("resourceCategories")&&!isProductCategoryShown(d.event.extendedProps.resourceCategories)){$(d.el).addClass("hidden")}else{$(d.el).removeClass("hidden")}var e="div";if(d.view.constructor.name==="DayGridView"){e="span"}else{if(d.view.constructor.name==="ResourceTimeGridView"){$(d.el).find(".fc-title").remove()}}if(!d.event.extendedProps.hasOwnProperty("isExternal")||!d.event.extendedProps.isExternal){$(d.el).find(".fc-title").first().before("<"+e+' class="wbe-booking-id">#'+d.event.id+"</"+e+">")}if(d.event.extendedProps.hasOwnProperty("bookedBy")){$(d.el).find(".fc-content").first().append("<"+e+' class="wbe-booked-by">Booked by '+d.event.extendedProps.bookedBy+"</"+e+">")}if(d.event.extendedProps.hasOwnProperty("bookedFor")){$(d.el).find(".fc-content").first().append("<"+e+' class="wbe-booked-for">Booked for '+d.event.extendedProps.bookedFor+"</"+e+">")}if(d.event.extendedProps.hasOwnProperty("persons")){$(d.el).find(".fc-content").first().append("<"+e+'n class="wbe-pax">('+d.event.extendedProps.persons+" pax)</"+e+">")}},eventResize:a,eventDrop:a,select:function(d){var e={_wpnonce:fullcalendarOptions.events.nonce,start:d.start!==null?d.start.toISOString():null,end:d.end!==null?d.end.toISOString():null,allDay:d.allDay,resource:d.hasOwnProperty("resource")&&d.resource!==null?d.resource.id:null};tb_show(fullcalendarOptions.createEventTitle,fullcalendarOptions.events.eventPageUrl+"&"+$.param(e))},dateClick:function(d){console.log("dateClick",d.date,d.resource?d.resource.id:"(no resource)")},viewSkeletonRender:function(e){var d=document.createElement("div");d.setAttribute("id","loading-overlay");d.setAttribute("class","loading");e.el.appendChild(d)},loading:function(e,d){if(e){$("#loading-overlay").addClass("loading")}else{$("#loading-overlay").removeClass("loading")}}});calendarRemoveHiddenResources();calendar.render()});