var calendar;var isCalendarInit=true;function luminance(f,e,a){var c=[f,e,a];for(var d=0;d<3;d++){c[d]=c[d]/255;if(c[d]<=0.03928){c[d]=c[d]/12.92}else{c[d]=Math.pow(((c[d]+0.055)/1.055),2.4)}}return 0.2126*c[0]+0.7152*c[1]+0.0722*c[2]}function hexToRgb(c){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;c=c.replace(b,function(e,h,f,d){return h+h+f+f+d+d});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function isProductCategoryShown(b){var d=jQuery(".manage-column[id]:not(.hidden)").map(function(){if(this.id==="wbe-uncategorized"){return this.id}return Number(this.id.substring(13))}).get();if(0===b.length&&-1<d.indexOf("wbe-uncategorized")){return true}var a=b.length;for(var c=0;c<a;c++){if(-1!==d.indexOf(b[c])){return true}}return false}function calendarRemoveHiddenResources(){calendar.refetchResources();var d=calendar.getResources();var a=d.length;for(var c=0;c<a;c++){var b=[];if(d[c].extendedProps.hasOwnProperty("categories")){b=d[c].extendedProps.categories}if(!isProductCategoryShown(b)){d[c].remove()}}}var oldSaveManageColumnsState=window.columns.saveManageColumnsState;window.columns.saveManageColumnsState=function(){calendarRemoveHiddenResources();oldSaveManageColumnsState.call(window.columns)};document.addEventListener("DOMContentLoaded",function(){var b=document.getElementById("calendar");var c=[];function a(e){if(!confirm(fullcalendarOptions.confirmMoveMessage)){e.revert()}else{var d=e.event.end;if(null===d&&false===e.event.allDay){d=new Date(e.event.start.getTime()+3600000)}var f={_ajax_nonce:fullcalendarOptions.events.nonce,id:e.event.id,start:e.event.start!==null?e.event.start.toISOString():null,end:d!==null?d.toISOString():null,allDay:e.event.allDay};if(e.hasOwnProperty("newResource")&&e.newResource!==null){f.resource=e.newResource.id}c.booking=jQuery.ajax({type:"POST",url:fullcalendarOptions.events.wctargetUrl,data:f,success:function(g){calendar.refetchEvents()},error:function(g,i,h){e.revert()},complete:function(){},dataType:"json"})}}calendar=new FullCalendar.Calendar(b,{plugins:["interaction","resourceDayGrid","resourceTimeGrid","list"],defaultView:fullcalendarOptions.defaultView,defaultDate:fullcalendarOptions.defaultDate,schedulerLicenseKey:fullcalendarOptions.schedulerLicenseKey,allDaySlot:true,editable:true,selectable:true,eventLimit:true,nowIndicator:true,navLinks:true,contentHeight:"auto",businessHours:[{daysOfWeek:[1,2,3,4,5],startTime:"08:00",endTime:"17:00"},{daysOfWeek:[6],startTime:"13:00",endTime:"17:00"}],customButtons:{addButton:{icon:"fc-icon-plus-square",click:function(){tb_show(fullcalendarOptions.createEventTitle,fullcalendarOptions.events.eventPageUrl+"&"+jQuery.param({_wpnonce:fullcalendarOptions.events.nonce}))}}},header:{left:"addButton, prev,next today",center:"title",right:"resourceTimeGridDay,resourceTimeGridTwoDay,timeGridWeek,dayGridMonth,listWeek"},views:{resourceTimeGridTwoDay:{type:"resourceTimeGrid",duration:{days:2},buttonText:"2 days"},listWeek:{buttonText:"list"}},resources:fullcalendarOptions.resources,eventSources:[{url:fullcalendarOptions.events.sourceUrl,method:"POST",extraParams:{_ajax_nonce:fullcalendarOptions.events.nonce}}],eventRender:function(i){jQuery(i.el).on("click",function(k){if(jQuery(this).attr("id").length&&jQuery(this).attr("id").substring(0,10)==="wbe-event-"){var l={_wpnonce:fullcalendarOptions.events.nonce,id:jQuery(this).attr("id").substring(10)};tb_show(fullcalendarOptions.updateEventTitle,fullcalendarOptions.events.eventPageUrl+"&"+jQuery.param(l))}k.preventDefault()});if(i.event.rendering===""&&!(i.event.extendedProps.hasOwnProperty("isExternal")&&i.event.extendedProps.isExternal===true)){var e=jQuery("#wbe-calendar-legend ul");var h="wbe-legend-item";var g=i.event.extendedProps.createdBy;if(i.event.extendedProps.createdById===fullcalendarOptions.loggedInUserId){g+=" (You)"}if(jQuery("#wbe-legend-admin-"+i.event.extendedProps.createdById).length===0){e.append('<li id="wbe-legend-admin-'+i.event.extendedProps.createdById+'" class="'+h+'"><span style="background-color:'+i.event.backgroundColor+'">&nbsp;</span>'+g+"</li>")}var d=hexToRgb(i.event.backgroundColor);var f=luminance(d.r,d.g,d.b);if(f>0.179){jQuery(i.el).find(".fc-content").css({color:"#000"})}else{jQuery(i.el).find(".fc-content").css({color:"#fff"})}}if(i.event.id.length){if(i.event.extendedProps.hasOwnProperty("isExternal")&&i.event.extendedProps.isExternal){jQuery(i.el).attr("id","ext-event-"+i.event.id)}else{jQuery(i.el).attr("id","wbe-event-"+i.event.id)}}if(i.event.extendedProps.hasOwnProperty("resourceCategories")&&!isProductCategoryShown(i.event.extendedProps.resourceCategories)){jQuery(i.el).addClass("hidden")}else{jQuery(i.el).removeClass("hidden")}var j="div";if(i.view.constructor.name==="DayGridView"){j="span"}else{if(i.view.constructor.name==="ResourceTimeGridView"){jQuery(i.el).find(".fc-title").remove()}}if(!i.event.extendedProps.hasOwnProperty("isExternal")||!i.event.extendedProps.isExternal){jQuery(i.el).find(".fc-title").first().before("<"+j+' class="wbe-booking-id">#'+i.event.id+"</"+j+">")}if(i.event.extendedProps.hasOwnProperty("bookedBy")){jQuery(i.el).find(".fc-content").first().append("<"+j+' class="wbe-booked-by">Booked by '+i.event.extendedProps.bookedBy+"</"+j+">")}if(i.event.extendedProps.hasOwnProperty("bookedFor")){jQuery(i.el).find(".fc-content").first().append("<"+j+' class="wbe-booked-for">Booked for '+i.event.extendedProps.bookedFor+"</"+j+">")}if(i.event.extendedProps.hasOwnProperty("persons")&&i.event.extendedProps.persons.length>0){jQuery(i.el).find(".fc-content").first().append("<"+j+' class="wbe-pax">('+i.event.extendedProps.persons+" pax)</"+j+">")}if(i.event.extendedProps.hasOwnProperty("status")&&i.event.extendedProps.status.length>0){jQuery(i.el).find(".fc-content").first().append("<"+j+' class="wbe-status">'+i.event.extendedProps.status+"</"+j+">")}},eventResize:a,eventDrop:a,select:function(d){var e={_wpnonce:fullcalendarOptions.events.nonce,start:d.start!==null?d.start.toISOString():null,end:d.end!==null?d.end.toISOString():null,allDay:d.allDay,resource:d.hasOwnProperty("resource")&&d.resource!==null?d.resource.id:null};tb_show(fullcalendarOptions.createEventTitle,fullcalendarOptions.events.eventPageUrl+"&"+jQuery.param(e))},dateClick:function(d){console.log("dateClick",d.date,d.resource?d.resource.id:"(no resource)")},viewSkeletonRender:function(e){var d=document.createElement("div");d.setAttribute("id","loading-overlay");if(isCalendarInit){d.setAttribute("class","loading");isCalendarInit=false}e.el.appendChild(d)},loading:function(e,d){if(e){jQuery("#loading-overlay").addClass("loading")}else{jQuery("#loading-overlay").removeClass("loading")}}});calendarRemoveHiddenResources();calendar.render()});